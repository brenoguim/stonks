<!DOCTYPE html>
<html>

<style>
table, td {
  border: 1px solid black;
}
</style>

<head>
<title>Stonks</title>
<meta charset="utf-8" />
</head>

<body>
  <h1>Adicionar arquivo de movimentações</h1>

  <input type="file" name="inputfile" accept=".csv" id="inputfile"/>
  
<table id="myTable">

</table>
  
  
</body>
</html>

<script>
class Movimentacao {
    constructor(numAcoes, preco) {
        this.numAcoes = numAcoes;
        this.preco = preco;
    }
}

class Estado {
    constructor() {
        this.numAcoes = 0
        this.precoMedio = 0
        this.lucroAcumulado = 0
    }
}

function aplicarMovimentacao(estado, mov) {
    var valor = estado.numAcoes*estado.precoMedio
    estado.numAcoes += mov.numAcoes
    if (mov.numAcoes > 0) {
        precoMedio = (valor + mov.numAcoes * mov.preco) / estado.numAcoes
    }
}

var movimentacoes = {};

function CSVToMovimentacao(text) {
    var lines = text.split(/\r?\n|\r|\n/g);
    for (let i = 0; i < lines.length; i++) {
        if (lines[i].length == 0) {
            continue
        }
        
        var items = lines[i].split(/;/g)
        if (!(items[0] in movimentacoes)) {
            movimentacoes[items[0]] = []
        }
        movimentacoes[items[0]].push(new Movimentacao(items[1], items[2]))
    }
}

var states = {};

function updateTable() {
    var table = document.getElementById("myTable");
    for (const [acao, movs] of Object.entries(movimentacoes)) {
        for (let i = 0; i < movs.length; i++) {
            var row = table.insertRow(0);
            row.insertCell(0).innerHTML = acao;
            row.insertCell(1).innerHTML = movs[i].numAcoes;            
            row.insertCell(2).innerHTML = movs[i].preco;
        }
    }
}

document.getElementById('inputfile')
    .addEventListener('change', function() {
    
        var fr=new FileReader();
        fr.onload= function() {
            movimentacoes = {};
            CSVToMovimentacao(fr.result)
            states = {};
            updateTable();
        }
          
        fr.readAsText(this.files[0]);
    })
</script>
